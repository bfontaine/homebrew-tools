#! /bin/bash -e

# brew done: for when you’ve done with your changes on a formula and are ready
#            to submit a patch. This only create a branch on your remote repo,
#            you then have to open a PR.
#
# Usage:
#     brew done <formula> <change>
#   change: a short identifier for the change, e.g. "test", "modernize"
#
# Issues:
#   this doesn’t work if you already have a branch for this change.
__brew_done() {
  local formula=$1
  local change=$2
  local branch="${formula}-${change}"
  local fork=`git config github.user`/homebrew
  local open_cmd=

  brew audit $formula

  cd $HOMEBREW_PREFIX
  git checkout master  # just in case
  git checkout -b "${formula}-${change}"
  git add Library/Formula/${formula}.rb
  git commit
  git push -u "git@github.com:$fork" "$branch"
  git checkout master

  open_cmd="open 'https://github.com/$fork/compare/${branch}?expand=1'"

  if [ "$(uname)" -eq "Darwin" ]; then
    $open_cmd
  else
    echo "$open_cmd"
  fi
}
__brew_done $*
